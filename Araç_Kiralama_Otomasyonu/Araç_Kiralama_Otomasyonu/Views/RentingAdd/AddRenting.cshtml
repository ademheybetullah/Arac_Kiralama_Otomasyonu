@model EntityLayer.Concrete.Renting
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
    <link href="~/Scripts/Css/Navbar.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>
    <title>AddRenting</title>
    <style>
        .col {
            color: #4c4c4c;
            font-weight: 500;
            text-align: center;
        }

        p {
            height: 100px;
            color: #cfb53b;
            font-family: 'Segoe UI';
            font-weight: bold;
            font-size: 30px;
            text-align: center;
            margin: auto;
            margin-top: 20px;
            margin-bottom: -15px;
        }

        input select {
            margin-top: 10px;
            margin-bottom: 40px;
        }

        #addBtn {
            width: 130px;
            height: 52px;
            background-color: #4c4c4c;
            color: #cfb53b;
            font-weight: 600;
            font-size: 16px;
            border: none;
            border-radius: 50px;
            margin-top: 20px;
            margin-left: -25px;
            margin-bottom: 10px;
        }

        #firstDate datepicker {
            background: #333;
            border: 1px solid #555;
            color: #EEE;
        }

        #addBtn:hover {
            background-color: #32353a;
            color: #9b870c;
        }

    </style>
</head>

<body>
    <div class="row">

        @Html.Partial("CustomerNavbar")
        <p>Kirala</p>
        <div class="col">
            <form class="form-control" method="post">
                <input style="display: none; visibility: hidden;" class="form-control" placeholder="UserId Id" name="UserId" value="@Session["CustomerId"]" />
                <input style="display: none; visibility: hidden;" class="form-control" value="@ViewBag.CarId" name="CarId" />
                <div class="row">
                    <div class="col">
                        Başlama Tarihi
                        <input id="firstDate" class="form-control firstDatePicker" placeholder="Başlangıç Tarihi" name="StartDate" autocomplete="off" />
                        @Html.ValidationMessageFor(x => x.StartDate)
                    </div>
                    <div class="col">
                        Bitiş Tarihi
                        <input id="lastDate" class="form-control lastDatePicker" placeholder="Bitiş Tarihi" name="FinishDate" autocomplete="off" />
                        @Html.ValidationMessageFor(x => x.FinishDate)
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        Araç Km
                        <input class="form-control" placeholder="FirstKm" name="FirstKm" value="@ViewBag.StartKm" readonly />
                    </div>
                    <div class="col">
                        Günlük Ücret
                        <input id="dailyFee" class="form-control" value="@ViewBag.RentingFee" readonly />
                    </div>
                    <div class="col">
                        Toplam Kira Bedeli
                        <input id="rentingFee" class="form-control" name="Payment" readonly />
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col">
                        &nbsp;
                    </div>
                    <div class="col-1">
                        <a href="@ViewBag.CarId"><button id="addBtn" type="submit" class="btn-default">Ekle</button></a>
                    </div>
                    <div class="col">
                        &nbsp;
                    </div>
                </div>

            </form>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            var date_range = [,];
            date_range = @Html.Raw(Json.Encode(ViewBag.Dates));
            var newArr = [];
            while (date_range.length) newArr.push(date_range.splice(0, 2));
            $(".firstDatePicker").datepicker({
                dateFormat: 'dd-mm-yy',
                minDate: 0,
                beforeShowDay: function (date) {

                    var string = $.datepicker.formatDate('dd-mm-yy', date);

                    for (var i = 0; i < newArr.length; i++) {

                        if (Array.isArray(newArr[i])) {

                            var from = new Date(newArr[i][0]);
                            var to = new Date(newArr[i][1]);
                            var current = new Date(string);

                            if (current >= from && current <= to) return false;
                        }

                    }
                    return [newArr.indexOf(string) == -1]
                }

            });
            $(".firstDatePicker").bind("change", function () {
                var firstDate = $('#firstDate').datepicker("getDate");
                $(".lastDatePicker").datepicker({
                    minDate: firstDate,
                    dateFormat: 'dd-mm-yy',
                    beforeShowDay: function (date) {
                        var string = $.datepicker.formatDate('dd-mm-yy', date);

                        for (var i = 0; i < newArr.length; i++) {

                            if (Array.isArray(newArr[i])) {

                                var from = new Date(newArr[i][0]);
                                var to = new Date(newArr[i][1]);
                                var current = new Date(string);

                                if (current >= from && current <= to) return false;
                            }

                        }
                        return [newArr.indexOf(string) == -1]
                    }
                });
            });

            $("#lastDate").change(function () {
                    var gunlukUcret = parseFloat($("#dailyFee").val());
                    var gunSayisi = parseFloat($("#lastDate").datepicker("getDate") - $("#firstDate").datepicker("getDate"));
                    gunSayisi = (gunSayisi / (1000 * 60 * 60 * 24)) + 1;
                    console.log(gunlukUcret * gunSayisi);
                    $("#rentingFee").val(gunlukUcret * gunSayisi);
                }
            );


    });
    </script>
    @Html.Partial("_Footer")
</body>
</html>
